<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <title>Big Bang Hello Chat!</title>
    <meta name="Content-Type" content="text/html; charset=UTF-8">
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="js/pnglib.js"></script>
    <script type="text/javascript" src="js/identicon.js"></script>
    <script type="text/javascript" src="bigbang.js"></script>

    <link rel="stylesheet" type="text/css" href="css/style.css"/>
    <script type="text/javascript">
        $(document).ready(function () {

            //Create an instance of the BigBangClient
            var client = new bigbang.client.BrowserBigBangClient();

            //Add your application here the format is: [yourapplication].app.bigbang.io
            var bbHost = "";

            if (bbHost === "") {
                alert("Please define bbHost. Format is [yourapplication].app.bigbang.io");
            }
            else {
                client.connectAnonymous(bbHost+":80", function (result) {
                    if (result.success) {
                        client.subscribe("somechannel", function (err, c) {
                            if (!err) {
                                beginChat(c);
                            }
                            else {
                                alert("Subscribe failure. " + err);
                            }
                        })
                    }
                    else {
                        alert("Failed to connect.");
                    }
                });
            }

            function beginChat(channel) {

                //
                channel.onMessage(function (msg) {
                    writeMessage(msg.senderId, msg.payload.getBytesAsJSON().msg);
                });

                channel.onSubscribers(function (joined) {
                    writeMessage(joined, "Joined the channel.");
                }, function (left) {
                    writeMessage(left, "Left the channel.");
                });


                $('#sendie').keyup(function (e) {
                    if (e.keyCode == 13) {
                        var text = $(this).val();
                        channel.publish({msg: text});
                        $(this).val("");
                    }
                });
            }

            function writeMessage(clientId, text) {
                var data = new Identicon(clientId, 32).toString();
                var img = '<img style="float:left;" width=32 height=32 src="data:image/png;base64,' + data + '">';
                $('#chat-area').append($("<p>" + img + text + "<br style='clear: both;' />  </p>"));
                document.getElementById('chat-area').scrollTop = document.getElementById('chat-area').scrollHeight;
            }
        });
    </script>
<body>
<div id="page-wrap">
    <h2>Big Bang Hello Chat!</h2>

    <p id="name-area"></p>

    <div id="chat-wrap">
        <div id="chat-area"></div>
    </div>

    <form id="send-message-area">
        <p>Your message: </p>
        <textarea id="sendie" maxlength='100'></textarea>
    </form>
</div>
</body>
</html>